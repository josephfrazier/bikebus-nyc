<!DOCTYPE html>
<html lang="en">
  <head>
    
    <!-- 
      This is the main Handlebars template for the site 
      - When the user visits the homepage or submits a color the app calls the endpoints in server.js
      - The server script passes data in here and the Handlebars code builds it into the HTML page
    -->
    
    <meta charset="utf-8" />
    <link rel="icon" href="https://glitch.com/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Bike Bus Beacon</title> 
  </head>
  <body>
        <!-- This is the start of content for our page -->
        <h1 class="title">Bike Bus Beacon</h1>
        
        
        {{#if true}}
          <pre id="location-preview"></pre>
        {{/if}}
    
        <script>
          
            let id;
            let target;
            let options;

            function success(pos) {
              busLatitude = pos.coords.latitude;
              busLongitude = pos.coords.longitude;
              
              updateBusLocation(busLatitude, busLongitude);
            }

            function error(err) {
              console.error(`ERROR(${err.code}): ${err.message}`);
            }

            options = {
              enableHighAccuracy: true,
              //timeout: 5000,
              //maximumAge: 0
            };

            id = navigator.geolocation.watchPosition(success, error, options);
          
            function updateLocationPreview(lat, long)
            {
              const previewElement = document.getElementById('location-preview');
              previewElement.prepend(Date() + ": " + lat + ", " + long + "\n")
              console.log(lat, long)
            }
          
            function updateBusLocation(lat, long)
            {
              fetch('/bus/location', {
                method: 'POST', // or 'PUT'
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  'latitude': lat,
                  'longitude': long
                }),
              })
                .then((response) => response.json())
                .then((data) => {
                  console.log('Success:', data)
                  updateLocationPreview(data.latitude, data.longitude)
                })
                .catch((error) => {
                  console.error('Error:', error)
                })
            }
            
        </script>
  </body>
</html>
